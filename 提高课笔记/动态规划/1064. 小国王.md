# 1064. 小国王

![2022-05-23_19-15-52](https://s2.loli.net/2022/05/23/hz7a9JmZAQsiSYK.png)

从上往下考虑, 由于第i行的摆法, 只与第i-1排有关, 而与第i-2排无关

因此我们可以以上一层的状态, 或者这一层的状态作为一个集合, 表示一类状态



我们用f(i, j, s)表示, 满足前 i 行已经摆好, 已经摆了 j 个国王, 第 i 行状态是s的集合的方案数.



只要给定第 i - 1 行的状态, 我们就可以推出第 i 行的选法数, 方案数.



下面讨论如何计算.

### 首先第 i 行和第 i - 1 行在转移之前需要满足**一定的条件**:

1. 第 i 行自身不能有相邻的 1 
2. 第 i - 1 行和第 i 行不能有相邻的 1 

(注: 这里没有说第 i - 1 行不能有相邻的 1 , 是因为在上一层的计算中, 已经要求它满足这个条件)

不妨设第 i 行的状态为 a , 第 i - 1 行的状态为 b , 那么上述条件可以写成:
$$
a不能有相邻的1 \\
a \& b == 0\\
 a | b 不能有相邻的 1 \\
$$
记为"**三项条件**".



### 为求f(i, j,s), 我们要进行集合的划分

我们枚举第 i - 1 行的状态(也就是b), 设第 i 行的状态为 a (令s = a), 然后对集合进行划分, 划分的个数与b可能的取值(与 a 有关)相同. 

对于第 k 个分块, 其含义为
$$
已经摆完了前i排，并且第i排的状态是a，第i-1排的状态是b_k，已经摆了j个国王的所有方案
$$
在这里, 对于每一个分块, a和b 都相当于是一个常数, 不同的是这两行之前的摆法, 一个分块表示的是这一类最后两行分别是b, a的集合(的方案数).



我们进一步转换.

为求每个分块对应的方案数, 我们去掉这个分块里所有元素的第 i 行 a , 可将其表示为
$$
已经摆完了前i - 1排，并且第i- 1排的状态是b_k，摆了j - cnt(a)个国王的所有方案
$$
这里解释一下合理性:

由于第 i 行的摆法, 只与第 i - 1 排有关, 而与第 i - 2 排无关, 因此只要第 i - 1 行的状态是$b_k$, $b_k$是满足"三项条件"的, 那么对于第$k$个分块里任意一个第 i 行是 a 的摆法, 都能在$f(i-1, j - cnt(a), b_k)$中找到一个与之一一对应的, 差别仅为第$i$行的摆法, 因此这两个集合的数量是相等的.



于是对于第 k 个分块, 它代表的方案数即为
$$
f(i - 1, j - cnt(a), b_k)
$$
结合我们的划分方式, 总的方案数即为
$$
f(i, j, a) = \sum_{k = 0}^{n}f(i-1, j- cnt(a), b_k)
$$



## 一些代码细节

1. f数组的第三个下标是状态在state数组里对应的下标，并不是一个二进制状态，但是开数组的时候，要开够那么大？。

2. `if ((a & b) == 0 && check(a | b))`千万不要写成`if ((a & b == 0) && check(a | b))`

3. 最后状态转移时的循环要理解清楚

   ![image-20220524190558692](C:\Users\wei\AppData\Roaming\Typora\typora-user-images\image-20220524190558692.png)
